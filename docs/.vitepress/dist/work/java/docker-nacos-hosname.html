<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>本机运行Nacos容器每次都要重新创建容器，该怎么办？ | My blog</title>
    <meta name="description" content="这是一个记录个人工作生活的博客">
    <meta name="generator" content="VitePress v1.3.0">
    <link rel="preload stylesheet" href="/free-blog/assets/style.CO_Tb4_a.css" as="style">
    
    <script type="module" src="/free-blog/assets/app.Ctrka07z.js"></script>
    <link rel="preload" href="/free-blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/free-blog/assets/chunks/framework.BBCWOUBu.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/theme.DGeli2J_.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/katex.CvgdMzdh.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/c4Diagram-ae766693.DeAD7yZ-.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/flowDiagram-b222e15a.Crw8jU1l.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/flowDiagram-v2-13329dc7.lItlR_sw.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/erDiagram-09d1c15f.CBrsyxfn.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/gitGraphDiagram-942e62fe.BCLY-jg1.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/ganttDiagram-b62c793e.aoAXHg3Q.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/infoDiagram-94cd232f.BumgxNj-.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/pieDiagram-bb1d19e5.BBzLThwq.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/quadrantDiagram-c759a472.BMNcnGas.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/xychartDiagram-f11f50a6.DK89Drde.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/requirementDiagram-87253d64.DeozOsP5.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/sequenceDiagram-6894f283.Tb9CBpjZ.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/classDiagram-fb54d2a0.DiQq_bi1.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/classDiagram-v2-a2b738ad.mbKMjGi_.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/stateDiagram-5dee940d.FXi5Etbw.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/stateDiagram-v2-1992cada.DEcw6rSa.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/journeyDiagram-6625b456.DOjRkD8R.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/flowchart-elk-definition-ae0efee6.BXtKfbqC.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/timeline-definition-bf702344.DlTPl12B.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/mindmap-definition-307c710a.DuSVfyL_.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/sankeyDiagram-707fac0f.CQh-nJjg.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/blockDiagram-9f4a6865.vZ9KlriQ.js">
    <link rel="modulepreload" href="/free-blog/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/free-blog/assets/work_java_docker-nacos-hosname.md.BRnUkKhN.lean.js">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M0BGESLHGT"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-M0BGESLHGT");</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c4daae71><!--[--><!--]--><!--[--><span tabindex="-1" data-v-b22defb4></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-b22defb4> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c4daae71 data-v-a46e73f0><div class="VPNavBar has-sidebar top" data-v-a46e73f0 data-v-bb7529ee><div class="wrapper" data-v-bb7529ee><div class="container" data-v-bb7529ee><div class="title" data-v-bb7529ee><div class="VPNavBarTitle has-sidebar" data-v-bb7529ee data-v-dbe614b8><a class="title" href="/free-blog/" data-v-dbe614b8><!--[--><!--]--><!----><span data-v-dbe614b8>My blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-bb7529ee><div class="content-body" data-v-bb7529ee><!--[--><!--]--><div class="VPNavBarSearch search" data-v-bb7529ee><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-bb7529ee data-v-5bacfe89><span id="main-nav-aria-label" class="visually-hidden" data-v-5bacfe89> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/free-blog/" tabindex="0" data-v-5bacfe89 data-v-2b93b872><!--[--><span data-v-2b93b872>主页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/free-blog/work/" tabindex="0" data-v-5bacfe89 data-v-2b93b872><!--[--><span data-v-2b93b872>工作</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/free-blog/life/" tabindex="0" data-v-5bacfe89 data-v-2b93b872><!--[--><span data-v-2b93b872>生活</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/free-blog/book/" tabindex="0" data-v-5bacfe89 data-v-2b93b872><!--[--><span data-v-2b93b872>读书笔记</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-bb7529ee data-v-123fcb2f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-123fcb2f data-v-fa1daf57 data-v-7012e5dd><span class="check" data-v-7012e5dd><span class="icon" data-v-7012e5dd><!--[--><span class="vpi-sun sun" data-v-fa1daf57></span><span class="vpi-moon moon" data-v-fa1daf57></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-bb7529ee data-v-08b35e6f data-v-f2234a39><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-f2234a39 data-v-50151957><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-bb7529ee data-v-0c845e5d data-v-8fd20e7d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8fd20e7d><span class="vpi-more-horizontal icon" data-v-8fd20e7d></span></button><div class="menu" data-v-8fd20e7d><div class="VPMenu" data-v-8fd20e7d data-v-39eca401><!----><!--[--><!--[--><!----><div class="group" data-v-0c845e5d><div class="item appearance" data-v-0c845e5d><p class="label" data-v-0c845e5d>Appearance</p><div class="appearance-action" data-v-0c845e5d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-0c845e5d data-v-fa1daf57 data-v-7012e5dd><span class="check" data-v-7012e5dd><span class="icon" data-v-7012e5dd><!--[--><span class="vpi-sun sun" data-v-fa1daf57></span><span class="vpi-moon moon" data-v-fa1daf57></span><!--]--></span></span></button></div></div></div><div class="group" data-v-0c845e5d><div class="item social-links" data-v-0c845e5d><div class="VPSocialLinks social-links-list" data-v-0c845e5d data-v-f2234a39><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-f2234a39 data-v-50151957><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-bb7529ee data-v-670493dd><span class="container" data-v-670493dd><span class="top" data-v-670493dd></span><span class="middle" data-v-670493dd></span><span class="bottom" data-v-670493dd></span></span></button></div></div></div></div><div class="divider" data-v-bb7529ee><div class="divider-line" data-v-bb7529ee></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-c4daae71 data-v-9d8129cc><div class="container" data-v-9d8129cc><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-9d8129cc><span class="vpi-align-left menu-icon" data-v-9d8129cc></span><span class="menu-text" data-v-9d8129cc>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-9d8129cc data-v-d1de893e><button data-v-d1de893e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-c4daae71 data-v-12a40e3d><div class="curtain" data-v-12a40e3d></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-12a40e3d><span class="visually-hidden" id="sidebar-aria-label" data-v-12a40e3d> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-ec086cd5><section class="VPSidebarItem level-0" data-v-ec086cd5 data-v-10acf738><div class="item" role="button" tabindex="0" data-v-10acf738><div class="indicator" data-v-10acf738></div><h2 class="text" data-v-10acf738>工作</h2><!----></div><div class="items" data-v-10acf738><!--[--><section class="VPSidebarItem level-1 is-link" data-v-10acf738 data-v-10acf738><div class="item" tabindex="0" data-v-10acf738><div class="indicator" data-v-10acf738></div><a class="VPLink link link" href="/free-blog/work/ai/" data-v-10acf738><!--[--><h3 class="text" data-v-10acf738>AI</h3><!--]--></a><!----></div><div class="items" data-v-10acf738><!--[--><div class="VPSidebarItem level-2 is-link" data-v-10acf738 data-v-10acf738><div class="item" data-v-10acf738><div class="indicator" data-v-10acf738></div><a class="VPLink link link" href="/free-blog/work/ai/lang-chain-rag.html" data-v-10acf738><!--[--><p class="text" data-v-10acf738>大模型RAG应用与LangChain4初探</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 is-link" data-v-10acf738 data-v-10acf738><div class="item" tabindex="0" data-v-10acf738><div class="indicator" data-v-10acf738></div><a class="VPLink link link" href="/free-blog/work/java/" data-v-10acf738><!--[--><h3 class="text" data-v-10acf738>Java</h3><!--]--></a><!----></div><div class="items" data-v-10acf738><!--[--><div class="VPSidebarItem level-2 is-link" data-v-10acf738 data-v-10acf738><div class="item" data-v-10acf738><div class="indicator" data-v-10acf738></div><a class="VPLink link link" href="/free-blog/work/java/java-thread-pool.html" data-v-10acf738><!--[--><p class="text" data-v-10acf738>Java线程池知识点梳理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-10acf738 data-v-10acf738><div class="item" data-v-10acf738><div class="indicator" data-v-10acf738></div><a class="VPLink link link" href="/free-blog/work/spring/spring-circular-dependency.html" data-v-10acf738><!--[--><p class="text" data-v-10acf738>Spring Bean循环依赖探究</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 is-link" data-v-10acf738 data-v-10acf738><div class="item" tabindex="0" data-v-10acf738><div class="indicator" data-v-10acf738></div><a class="VPLink link link" href="/free-blog/work/other/" data-v-10acf738><!--[--><h3 class="text" data-v-10acf738>其他</h3><!--]--></a><!----></div><div class="items" data-v-10acf738><!--[--><div class="VPSidebarItem level-2 is-link" data-v-10acf738 data-v-10acf738><div class="item" data-v-10acf738><div class="indicator" data-v-10acf738></div><a class="VPLink link link" href="/free-blog/work/other/docker-nacos-hosname.html" data-v-10acf738><!--[--><p class="text" data-v-10acf738>本机运行Nacos容器每次都要重新创建容器，该怎么办？</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c4daae71 data-v-d2aef184><div class="VPDoc has-sidebar has-aside" data-v-d2aef184 data-v-ef3a4dda><!--[--><!--]--><div class="container" data-v-ef3a4dda><div class="aside" data-v-ef3a4dda><div class="aside-curtain" data-v-ef3a4dda></div><div class="aside-container" data-v-ef3a4dda><div class="aside-content" data-v-ef3a4dda><div class="VPDocAside" data-v-ef3a4dda data-v-79cae1a0><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-79cae1a0 data-v-dfbd9fb8><div class="content" data-v-dfbd9fb8><div class="outline-marker" data-v-dfbd9fb8></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-dfbd9fb8>On this page</div><ul class="VPDocOutlineItem root" data-v-dfbd9fb8 data-v-da421f78><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-79cae1a0></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-ef3a4dda><div class="content-container" data-v-ef3a4dda><!--[--><!--]--><main class="main" data-v-ef3a4dda><div style="position:relative;" class="vp-doc _free-blog_work_java_docker-nacos-hosname" data-v-ef3a4dda><div><h1 id="本机运行nacos容器每次都要重新创建容器-该怎么办" tabindex="-1">本机运行Nacos容器每次都要重新创建容器，该怎么办？ <a class="header-anchor" href="#本机运行nacos容器每次都要重新创建容器-该怎么办" aria-label="Permalink to &quot;本机运行Nacos容器每次都要重新创建容器，该怎么办？&quot;">​</a></h1><p>背景是这样的，本机通过Docker 容器运行Nacos，我这里使用<code>docker -e</code> 来设置环境变量，来给容器传递参数。命令如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nacos-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">8848:8848</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">9848:9848</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">9849:9849</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MODE=standalone</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SPRING_DATASOURCE_PLATFORM=mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_HOST=xxx.xx.xxx.xx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_PORT=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3306</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_USER=xxxx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_PASSWORD=xxxx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_DB_NAME=nacos</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TIME_ZONE=&#39;Asia/Shanghai&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/Users/zhw/myDevelop/nacos2/logs:/home/nacos/logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/Users/zhw/myDevelop/nacos2/data:/home/nacos/data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-d </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nacos/nacos-server:v2.1.2-slim</span></span></code></pre></div><p>但是，我在公司正常运行但是回家后启动容器时，却会发生Nacos无法启动成功的问题，日志显示的如此眼熟，Nacos初次使用时经常遇到的无法连接数据库的异常又出现了。数据库为什么会连不上呢？</p><p>经过排查是 <code>MYSQL_SERVICE_HOST</code> 地址不对的问题，因为我的本机IP变了，因为使用公司网络和使用家中WIFI网络的本机IP是不一样的。</p><p>我的Mysql数据库是在本机安装的，Docker容器运行Nacos使用宿主机IP连接Mysql数据库，宿主机IP发生变化了，容器自然连不上了。</p><p>果然，删掉容器，将<code>MYSQL_SERVICE_HOST</code> 改为家中的本机IP后重新执行<code>docker run ...</code> 命令，容器Nacos正常启动，可以访问了。</p><hr><p>每次电脑换个网络连接，想启动容器还要修改连接数据库的IP地址，重新执行创建容器的命令，这太不优雅了，怎么办呢？</p><p>我们在终端通过mysql命令连接数据库命令是<code>mysql -h -u</code> 这里的<code>-h</code> 就是指hostname，思路来了，何不在<code>docker run</code>命令中使用hostname 作为数据库连接地址参数呢。主机名可以自定义，而且不会随着电脑连接网络的变化而变化。</p><p>立马尝试一下，分四步：</p><ol><li>设置主机名</li><li>配置hosts文件IP映射</li><li>使用这个主机名创建Mysql连接账号并权限</li><li>修改 docker run 命令，数据库地址环境变量参数使用使用主机名</li><li>docker run 启动，成功访问</li></ol><p>首先在终端命令查询本机的hostname是什么？如果没有就设置主机名</p><p>获取主机名，发现没有设置</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scutil</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HostName</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>not set</span></span></code></pre></div><p>设置主机名</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sudo scutil --set HostName bruce.local.mac</span></span></code></pre></div><p>获取主机名，成功返回刚刚设置的主机名</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>scutil --get HostName</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>bruce.local.mac</span></span></code></pre></div><p>在hosts文件设置 bruce.local.mac 映射到本机IP，ping 一下主机名，有数据返回，没有问题</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ping bruce.local.mac</span></span></code></pre></div><p>然后就要创建Mysql 用户名以及对应权限了。</p><p>创建数据库用户</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE USER nacos@&#39;bruce.local.mac&#39; IDENTIFIED BY &#39;nacos&#39;;</span></span></code></pre></div><p>授权</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>grant all privileges on nacos.* to nacos@&#39;bruce.local.mac&#39;;</span></span></code></pre></div><p>测试连接，成功连接</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>mysql -u nacos -h bruce.local.mac -p</span></span></code></pre></div><p>修改 docker run 命令如下</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nacos-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">8848:8848</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">9848:9848</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">9849:9849</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MODE=standalone</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SPRING_DATASOURCE_PLATFORM=mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_HOST=bruce.local.mac</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_PORT=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3306</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_USER=nacos</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_PASSWORD=nacos</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL_SERVICE_DB_NAME=nacos</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TIME_ZONE=&#39;Asia/Shanghai&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/Users/zhw/myDevelop/nacos2/logs:/home/nacos/logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/Users/zhw/myDevelop/nacos2/data:/home/nacos/data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-d </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nacos/nacos-server:v2.1.2-slim</span></span></code></pre></div><p>执行docker run命令成功启动。</p><p>这样下次电脑连接其他网络时，启动容器只需要<code>docker start</code> 就好了，不需要重新<code>docker run</code> 创建容器。</p></div></div></main><footer class="VPDocFooter" data-v-ef3a4dda data-v-07d71ff1><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-07d71ff1><span class="visually-hidden" id="doc-footer-aria-label" data-v-07d71ff1>Pager</span><div class="pager" data-v-07d71ff1><!----></div><div class="pager" data-v-07d71ff1><a class="VPLink link pager-link next" href="/free-blog/work/ai/" data-v-07d71ff1><!--[--><span class="desc" data-v-07d71ff1>Next page</span><span class="title" data-v-07d71ff1>AI</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"DH9rHAOi\",\"apitest.md\":\"CnMtJsNj\",\"book_index.md\":\"D436GbAL\",\"book_microservices-design.md\":\"CuA4XivS\",\"guide_index.md\":\"CTiICCJr\",\"index.md\":\"8F-2k9RU\",\"life_index.md\":\"B_peZPZF\",\"life_my-life.md\":\"ZLH_ZRJK\",\"markdown-examples.md\":\"C_rykiya\",\"work_ai_index.md\":\"DRArcINA\",\"work_ai_lang-chain-rag.md\":\"NxkR8En4\",\"work_algorithms_index.md\":\"C7ydij7h\",\"work_index.md\":\"BVVaoF92\",\"work_java_docker-nacos-hosname.md\":\"BRnUkKhN\",\"work_java_index.md\":\"bPKTMAaQ\",\"work_java_java-thread-pool.md\":\"BqRAqedn\",\"work_notes_index.md\":\"gUvdtYx3\",\"work_notes_microservices-read.md\":\"D7PbiEmp\",\"work_one.md\":\"NBdVczYf\",\"work_other_docker-nacos-hosname.md\":\"Cf1gRTFj\",\"work_other_index.md\":\"BpXYaAcC\",\"work_spring_index.md\":\"TwVJDIlK\",\"work_spring_spring-circular-dependency.md\":\"Dq4TIj2r\",\"work_two.md\":\"CICX2xkh\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"My blog\",\"description\":\"这是一个记录个人工作生活的博客\",\"base\":\"/free-blog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"主页\",\"link\":\"/\"},{\"text\":\"工作\",\"link\":\"/work/\"},{\"text\":\"生活\",\"link\":\"/life/\"},{\"text\":\"读书笔记\",\"link\":\"/book/\"}],\"sidebar\":{\"/work/\":[{\"text\":\"工作\",\"items\":[{\"text\":\"AI\",\"link\":\"/work/ai/\",\"items\":[{\"text\":\"大模型RAG应用与LangChain4初探\",\"link\":\"/work/ai/lang-chain-rag\"}]},{\"text\":\"Java\",\"link\":\"/work/java/\",\"items\":[{\"text\":\"Java线程池知识点梳理\",\"link\":\"/work/java/java-thread-pool\"},{\"text\":\"Spring Bean循环依赖探究\",\"link\":\"/work/spring/spring-circular-dependency\"}]},{\"text\":\"其他\",\"link\":\"/work/other/\",\"items\":[{\"text\":\"本机运行Nacos容器每次都要重新创建容器，该怎么办？\",\"link\":\"/work/other/docker-nacos-hosname\"}]}]}],\"/life/\":[{\"text\":\"生活\",\"items\":[{\"text\":\"点滴生活\",\"link\":\"/life/my-life\"}]}],\"/book/\":[{\"text\":\"读书笔记\",\"items\":[{\"text\":\"微服务设计\",\"link\":\"/book/microservices-design/\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>